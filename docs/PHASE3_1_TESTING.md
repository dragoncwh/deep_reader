# Phase 3.1 全局搜索 - 手动测试指南

## 测试前准备

### 环境准备
1. 在 Xcode 中打开 `DeepReader/DeepReader.xcodeproj`
2. 选择 iOS 模拟器 (推荐 iPhone 15)
3. Build and Run (Cmd+R)

### 测试数据准备
1. **导入至少 2-3 本有文本内容的 PDF**
   - 确保 PDF 有可选择的文本（非扫描件）
   - 建议使用包含中英文的 PDF 以测试多语言搜索
2. **记录每本书中的一些关键词**，用于后续搜索测试

---

## 测试用例

### TC-3.1.1: 搜索栏显示与交互

| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 启动 App，进入书架页 | 看到书架网格和顶部搜索栏 |
| 2 | 点击搜索栏 | 键盘弹出，可以输入文字 |
| 3 | 输入任意文字 | 书架网格消失，显示搜索结果区域 |
| 4 | 清空搜索框（点击 X 或删除所有文字） | 搜索结果消失，书架网格恢复显示 |
| 5 | 输入中文关键词 | 正常显示，无乱码 |
| 6 | 输入英文关键词 | 正常显示 |

---

### TC-3.1.2: 搜索结果显示

**前置条件**: 已导入包含文本的 PDF

| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 在搜索栏输入 PDF 中存在的关键词 | 显示 "Searching..." 加载状态 |
| 2 | 等待搜索完成 | 显示搜索结果列表 |
| 3 | 输入 PDF 中不存在的随机字符串 | 显示 "No Results Found" 空结果提示 |
| 4 | 搜索一个在多本书中都存在的词 | 结果按相关性排序，显示多本书的结果 |

---

### TC-3.1.3: 搜索结果行显示

**前置条件**: 搜索返回了结果

| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 查看搜索结果列表中的任意一行 | 显示：书名、页码、匹配片段 |
| 2 | 检查匹配片段 | 关键词应该以粗体/高亮颜色显示 |
| 3 | 检查长书名 | 单行显示，超出部分截断 |
| 4 | 检查长片段 | 最多显示 3 行，超出部分截断 |

---

### TC-3.1.4: 搜索结果跳转

**前置条件**: 搜索返回了结果

| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 点击任意搜索结果 | 1. 搜索界面关闭<br>2. 打开对应书籍的阅读器 |
| 2 | 检查阅读器页码 | 自动跳转到搜索结果中显示的页码 |
| 3 | 返回书架 | 搜索栏已清空，显示书架网格 |
| 4 | 再次搜索并点击另一本书的结果 | 正确打开另一本书并跳转到对应页面 |

---

### TC-3.1.5: 搜索防抖

| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 快速连续输入 "test" (t-e-s-t) | 不会在每次按键后立即搜索 |
| 2 | 输入后等待约 300ms | 搜索自动执行 |
| 3 | 输入一个词，在搜索完成前继续输入 | 前一个搜索被取消，只执行最后一次搜索 |
| 4 | 快速输入长字符串然后立即清空 | 不会触发不必要的搜索请求 |

**验证方法**: 可以在 Xcode 控制台观察日志，或在 `GlobalSearchResultsView.performSearch()` 中临时添加 `print("Searching: \(searchText)")` 来验证防抖效果。

---

### TC-3.1.6: 边界情况测试

| 场景 | 操作 | 预期结果 |
|------|------|----------|
| 空书架搜索 | 删除所有书籍后进行搜索 | 显示 "No Results Found" |
| 特殊字符搜索 | 搜索 `"`, `'`, `\`, `%` 等 | 不崩溃，正常返回结果或空 |
| 超长搜索词 | 输入 100+ 字符的搜索词 | 不崩溃，正常处理 |
| 纯空格搜索 | 输入多个空格 | 不执行搜索或返回空结果 |
| 搜索中切换 App | 搜索过程中切到后台再回来 | App 不崩溃，搜索正常完成或可重新搜索 |

---

## 已知限制

1. **扫描件 PDF 不可搜索** - 扫描件（纯图片 PDF）需要 OCR 处理后才能搜索，这是 Phase 3.2 的功能
2. **新导入的书籍** - 导入后需要等待文本提取完成才能被搜索到

---

## 问题排查

### 搜索无结果但确定 PDF 有该文本
1. 确认 PDF 是否有文本层（尝试在 PDF 中选择文字）
2. 检查书籍是否已完成文本提取（导入时有进度提示）
3. 在 Xcode 控制台查看是否有错误日志

### 点击结果后页面跳转不正确
1. 检查 `SearchResult.pageNumber` 是否为 0-indexed 或 1-indexed
2. 确认 `ReaderViewModel.goToPage()` 的参数约定

### 搜索性能问题
1. 检查 FTS5 索引是否正常创建
2. 大量书籍时考虑分页加载结果

---

## 测试完成检查清单

- [ ] 搜索栏正常显示和交互
- [ ] 搜索结果正确显示书名、页码、片段
- [ ] 关键词在片段中高亮显示
- [ ] 点击结果能正确跳转到对应书籍和页面
- [ ] 防抖机制正常工作（不会每次按键都搜索）
- [ ] 空结果有友好提示
- [ ] 中英文搜索都正常
- [ ] 无崩溃或明显 UI 问题
